<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<!-- 1.构造一个数组，数组中是一个一个的对象，每个对象不少于4个键
		2.将音乐的信息显示在u1中，用哪些标签自己分配自己搭配
		3.删除数组里的数据和删除dom对象 -->
		
		
		<ul class="list"><button class="btn-update">修改</button></ul>
		
		<script src="../jQuery-1.8.2.js"></script>
		<script src="../layer/layer.js"></script>
		<!-- //上述二者顺序不能变,因为layer依赖jQuery -->
		<script type="text/javascript">
			var musics=[
			    {id: 1,singer: '熊木杏里',song:'碧绿色的小兔子',tv:'星之金币'},
			    {id: 20,singer: '熊木杏里',song:'man in the mirror',tv:'摩登之夜'},
			    {id: 30,singer: '熊木杏里',song:'樱',tv:'追逐繁星的孩子'},
			];//id 30之内,除了1,20,之外的id都已经作废
			//添加数组元素进入dom组件li等:${},再将此组件加入ul
			function generateHtml(music){
				//data-id,藏值的格式data-
				return `
						<li data-id="${music.id}">
							<h3>${music.singer}</h3>
							<p>${music.song}</p>
							<span>${music.tv}</span>
							<button class="btn-remove">删除</button>
							<button class="btn-add">新增</button>
						</li>
				`;
			}
			musics.forEach(function(item){
				$(generateHtml(item)).appendTo('ul.list');
			});
			
			// // 获取在ul组件下的指定的子组件btn-remove(on方法的第二个参数可以指定),并为该组件添加点击事件
			// //事件委托:由于为10个子组件添加相同的点击事件,就会在内存中,在10处存10个相同的函数,这样浪费内存,
			// // 所以可以通过事件冒泡(触发子组件，一次就会执行子组件，父组件，爷爷组件的相同事件),所以委托给洗衣机做
			$('ul.list')
			.on('click','button.btn-remove',function(){
				
				var that=this;//获取当前对象,然后获取其父组件(li)的id,该id的储存方式是:藏值:data-id,格式data-是藏值的格式
				// 由于之后有绑定事件,this会变化,所以,记录下此时的this
				layer.confirm('确定要删除吗',{btn:['确定','取消']},function(){
					// var id=$(that).parent().attr('data-id');//字符串值
					var id=parseInt($(that).parent().attr('data-id'));
					//删除分两部分:01删除数组内容;02删除dom组件
					
					// 01.删除数组内容元素(splice),需要知道下标(arr.splice(i,howmany))
					//获取数组元素下标,注意,注意,注意,id的值不一定像1,2,3这样顺着排,可能是,10,20,30,而数组是0,1,2,3,4
					var i=musics.findIndex(function(item){
						return item===id;
					});
					musics.splice(i,1);
					//02.
					$(that).parent().remove();
					layer.alert('删除成功');
				});
			})
			.on('click','button.btn-update',function(){
				//组件id,数组元素位置
				var id=$(this).parent().attr('data-id');
				var i=musics.findIndex(function(item){
					return item.id===id;
				});
				var that=this;
				layer.open({
					title:'编辑',
					content:`
							<input type="text" class="singer" value="${musics[i].singer}" placeholder='请输入歌手'/>
							<input type="text" class="song" value="${musics[i].song}" placeholder='请输入歌名'/>
							<input type="text" class="tv" value="${musics[i].tv}" placeholder='请输入tv'/>
					`,
					yes:function(){
						var singer=$('input.singer').val().trim();
						var song=$('input.song').val().trim();
						var tv=$('input.tv').val().trim();
						var id=id;
						var music={id,singer,song,tv};//
						musics.splice(i,1,music);//在数据中加入
						// $(that).parent().before($(generateHtml(music))).remove;
						$(that).parent().replaceWith(generateHtml(music));//在文档中加入
						layer.alert('修改成功');
					}
				});
				
			}); 
			 
		</script>
	</body>
</html>
